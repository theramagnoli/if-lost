import{_ as S,o as v,I as U,d as q,e as z,a as b,b as N,r as T,s as E,u as H,c as d,f as c,g as t,t as p,w as m,v as h,h as u,i as _,j as g,F as L,p as M,k as B}from"./index.1fea5df6.js";const R={data(){return{destino:"",info_destino:"",hora_salida:"12",minutos_salida:"00",hora_alerta:"17",minutos_alerta:"00",infoextra:"",img:"",imgurl:"",infofoto:"",mapa:"",mapa_google:"",paso:0,datos:[],uid:"",srcimg:"https://firebasestorage.googleapis.com/v0/b/if-lost-159f6.appspot.com/o/assets%2Fcamera.png?alt=media"}},mounted(){this.obtenerUsuario(),v(b,async i=>{if(i){const e=U(q,"infoUsuarios",i.uid),n=await z(e);n.exists()&&(this.datos=n.data())}})},methods:{buscarEnMapa(){let i="https://maps.google.com/maps?q="+this.destino+"&t=&z=13&ie=UTF8&iwloc=&output=embed";document.querySelector("#gmap_canvas").setAttribute("src",i),this.mapa=i},obtenerHoraComoFecha(i,e,n){let l;if(n==!1)l=new Date().setHours(parseInt(i),parseInt(e),0);else{const s=new Date,r=new Date(s);r.setDate(r.getDate()+1),l=r.setHours(parseInt(i),parseInt(e),0)}return l},async crearViaje(){let i,n=new Date().getHours();this.hora_alerta<this.hora_salida||this.hora_alerta<n?i=!0:i=!1,await v(b,async l=>{l&&await N(U(q,"viajes",l.uid),{correo_contacto:this.datos.correo_contacto,destino:this.destino,mapa:this.mapa_google,infoextra_destino:this.info_destino,hora_salida:this.hora_salida+":"+this.minutos_salida,hora_llegada:this.hora_alerta+":"+this.minutos_alerta,infoextra:this.infoextra,fecha_alerta:this.obtenerHoraComoFecha(this.hora_alerta,this.minutos_alerta,i),img:this.imgurl,infoimg:this.infofoto}),this.$router.push("/")})},async previsualizar(){await this.paso++;let i=document.querySelector("#img_prev"),e=this.destino.split(" ");for(var n=0;n<e.length;n++)e[n]=e[n].charAt(0).toUpperCase()+e[n].slice(1);this.destino=e.join(" "),this.mapa_google="https://maps.google.com/maps?q="+this.destino+"&t=&z=13&ie=UTF8&iwloc=&",this.imgurl.length>1?i.src="https://firebasestorage.googleapis.com/v0/b/if-lost-159f6.appspot.com/o/viajes%2F"+this.uid+"?alt=media":i.src="/images/viajedef.jpg"},obtenerUsuario(){v(b,i=>{i?this.uid=i.uid:this.$router.push("/login")})},async tomarFoto(){this.srcimg="https://firebasestorage.googleapis.com/v0/b/if-lost-159f6.appspot.com/o/assets%2Floading.gif?alt=media";let i=this,e=document.querySelector("#camera"),n=document.querySelector("#canvas"),l=document.querySelector("#capturar"),s=document.querySelector("#tomafoto"),r=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});this.$refs.imgviaje.setAttribute("hidden","true"),this.$refs.divfoto.removeAttribute("hidden"),n.setAttribute("hidden","true"),e.removeAttribute("hidden"),l.removeAttribute("hidden"),e.srcObject=r,l.addEventListener("click",function(){e.setAttribute("hidden","true"),n.getContext("2d").drawImage(e,0,0,n.width,n.height),this.img=n.toDataURL("image/jpeg"),i.subirImg(this.img),r.getTracks().forEach(function(a){a.stop()}),l.setAttribute("hidden","true"),s.innerHTML="\xBFNo te gust\xF3? Intenta de nuevo"})},subirImg(i){this.$refs.imgviaje.removeAttribute("hidden");let e=this;const n=document.createElement("img");n.src=i,n.onload=function(l){const s=document.createElement("canvas"),r=800,a=r/l.target.width;s.width=r,s.height=a*l.target.height;const y=s.getContext("2d");y.drawImage(l.target,0,0,s.width,s.height);const w=y.canvas.toDataURL(l.target,"image/png");function V(x,I){for(var k=x.split(","),D=k[0].match(/:(.*?);/)[1],j=atob(k[1]),f=j.length,C=new Uint8Array(f);f--;)C[f]=j.charCodeAt(f);return new File([C],I,{type:D})}var A=V(w,"perfil.png");const F=T(E,"viajes/"+e.uid);H(F,A).then(x=>{e.imgurl="https://firebasestorage.googleapis.com/v0/b/if-lost-159f6.appspot.com/o/viajes%2F"+e.uid+"?alt=media",e.srcimg=w})}}},watch:{}},o=i=>(M("data-v-405a4170"),i=i(),B(),i),G=o(()=>t("h1",{class:"ttl-1"},"Crear viaje",-1)),J={class:"grid mb-8"},O={class:"justify-self-center flex text-xs"},Y={class:"font-semibold text-center mt-4 bg-gray-50 text-gray-900 pt-2 pb-2 w-8 rounded-full shadow-inner"},K=o(()=>t("h2",{class:"text-center mt-4 pt-2 pb-2 w-10"},"de",-1)),P=o(()=>t("h2",{class:"font-semibold text-center mt-4 bg-gray-50 text-gray-900 pt-2 pb-2 w-8 rounded-full shadow-inner"}," 5 ",-1)),Q={key:0},W=o(()=>t("p",{class:"lbl"},"Dinos a d\xF3nde vas",-1)),X={class:"flex"},Z=o(()=>t("i",{class:"fa-solid fa-magnifying-glass"},null,-1)),$=[Z],tt=o(()=>t("div",{class:"mapouter"},[t("div",{class:"gmap_canvas shadow-xl"},[t("iframe",{width:"100%",height:"100%",id:"gmap_canvas",src:"https://maps.google.com/maps?q=monterrey&t=&z=13&ie=UTF8&iwloc=&output=embed",frameborder:"0",scrolling:"no",marginheight:"0",marginwidth:"0"})])],-1)),et=o(()=>t("p",{class:"lbl mt-4"}," Aqu\xED puedes agregar detalles del lugar, si gustas ",-1)),st=o(()=>t("button",{type:"submit",class:"btn-gray"},"Continuar",-1)),ot={key:1},at={class:"grid"},it=o(()=>t("p",{class:"lbl text-center"},"Dinos a qu\xE9 ahora planeas ir",-1)),nt={class:"flex place-content-center"},lt=o(()=>t("p",{class:"mx-2 place-self-center"},":",-1)),rt=o(()=>t("p",{class:"lbl text-center mt-4"},"Y la hora a la que planeas regresar",-1)),dt={class:"flex place-content-center"},ct=o(()=>t("p",{class:"mx-2 place-self-center"},":",-1)),ut=o(()=>t("button",{type:"submit",class:"btn-gray mt-12"},"Continuar",-1)),pt={key:2},mt={class:"flex mt-2"},ht=o(()=>t("p",{class:"lbl w-[88%] align-self-end flex-initial",id:"tomafoto"}," Toma una foto, si quieres ",-1)),_t=o(()=>t("i",{class:"fa-solid fa-camera"},null,-1)),gt=[_t],ft={class:"mt-2 shadow-xl",ref:"divfoto"},vt=o(()=>t("video",{width:"400",height:"300",autoplay:"",id:"camera",class:"mt-2 rounded-t-lg w-full",hidden:""},null,-1)),bt=o(()=>t("canvas",{id:"canvas",class:"mt-2 rounded-t-lg w-full",width:"400",height:"300",hidden:""},null,-1)),yt=["src"],wt=o(()=>t("button",{type:"button",id:"capturar",class:"rounded-b-lg w-full bg-sky-600 py-2 text-white hover:bg-sky-800 flex-intial",hidden:""}," Tomar foto ",-1)),xt={ref:"notafoto"},kt=o(()=>t("p",{class:"lbl mt-4"},"Agrega una nota a la foto",-1)),jt=o(()=>t("button",{type:"submit",class:"btn-gray"},"Continuar",-1)),Ct={key:3},Ut=o(()=>t("p",{class:"lbl mt-2"}," En este espacio puedes agregar una nota para tu contacto de confianza ",-1)),qt=o(()=>t("button",{type:"submit",class:"btn-gray"},"Continuar",-1)),Vt={key:4},At=o(()=>t("div",{class:"note grid"},[t("p",{class:"font-semibold"},[g(" Aseg\xFArate que todos los detalles de tu viaje sean correctos; "),t("span",{class:"font-normal"},"en caso de no avisar antes de la hora prevista, se enviar\xE1n a tu contacto de confianza")]),t("button",{class:"btn-gray w-[60%] justify-self-end"}," Ver mi contacto de confianza ")],-1)),Ft={class:"mt-4 grid grid-cols-2 gap-2"},It=o(()=>t("p",{class:"lbl"},"Destino",-1)),Dt={class:"note"},St=["href"],zt={key:0,class:"note"},Nt=o(()=>t("span",{class:"notettl"},"Detalles",-1)),Tt={key:1,class:"note"},Et=o(()=>t("span",{class:"notettl"},"No se agregaron m\xE1s detalles",-1)),Ht=[Et],Lt={class:"grid grid-cols-2 gap-2"},Mt=o(()=>t("p",{class:"lbl"},"Hora de salida",-1)),Bt={class:"note"},Rt=o(()=>t("p",{class:"lbl"},"Hora de regreso",-1)),Gt={class:"note"},Jt={class:"grid grid-cols-2 gap-2"},Ot=o(()=>t("img",{src:"",alt:"Imagen de viaje",id:"img_prev",class:"rounded-lg w-full mb-2 shadow-md"},null,-1)),Yt={key:0,class:"note"},Kt=o(()=>t("span",{class:"notettl"},"Nota de foto",-1)),Pt={key:1,class:"note"},Qt=o(()=>t("span",{class:"notettl"},"No se agreg\xF3 nota de foto",-1)),Wt=[Qt],Xt={key:0,class:"note"},Zt=o(()=>t("span",{class:"notettl"},"Nota",-1)),$t={key:1,class:"note"},te=o(()=>t("span",{class:"notettl"},"No se agreg\xF3 una nota",-1)),ee=[te];function se(i,e,n,l,s,r){return d(),c(L,null,[G,t("div",J,[t("div",O,[t("h2",Y,p(s.paso+1),1),K,P])]),s.paso==0?(d(),c("div",Q,[t("form",{onSubmit:e[3]||(e[3]=u(a=>s.paso++,["prevent"]))},[W,t("div",X,[m(t("input",{type:"text",id:"destino","onUpdate:modelValue":e[0]||(e[0]=a=>s.destino=a),placeholder:"Un lugar",class:"inp flex-initial w-[88%]",required:""},null,512),[[h,s.destino]]),t("button",{onClick:e[1]||(e[1]=u(a=>r.buscarEnMapa(),["prevent"])),class:"btn-blue w-[10%] ml-[2%] flex-1 mt-0"},$)]),tt,t("div",null,[et,m(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=a=>s.info_destino=a),placeholder:"ej. La casa de Jorge",class:"inp",rows:"3"},null,512),[[h,s.info_destino]])]),st],32)])):_("",!0),s.paso==1?(d(),c("div",ot,[t("form",{onSubmit:e[9]||(e[9]=u(a=>s.paso++,["prevent"]))},[t("div",at,[it,t("div",nt,[m(t("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=a=>s.hora_salida=a),required:"",max:"24",class:"inp w-[30%] text-center"},null,512),[[h,s.hora_salida]]),lt,m(t("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=a=>s.minutos_salida=a),required:"",max:"60",class:"inp w-[30%] text-center"},null,512),[[h,s.minutos_salida]])]),rt,t("div",dt,[m(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=a=>s.hora_alerta=a),required:"",max:"24",class:"inp w-[30%] text-center"},null,512),[[h,s.hora_alerta]]),ct,m(t("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=a=>s.minutos_alerta=a),required:"",max:"60",class:"inp w-[30%] text-center"},null,512),[[h,s.minutos_alerta]])])]),ut,t("button",{onClick:e[8]||(e[8]=u(a=>s.paso--,["prevent"])),class:"btn-gray"},"Volver")],32)])):_("",!0),s.paso==2?(d(),c("div",pt,[t("form",{onSubmit:e[13]||(e[13]=u(a=>s.paso++,["prevent"]))},[t("div",mt,[ht,t("button",{type:"button",onClick:e[10]||(e[10]=a=>r.tomarFoto()),class:"btn-blue w-[10%] ml-[2%] mt-0 py-0"},gt)]),t("div",ft,[vt,bt,t("img",{src:s.srcimg,width:"400",height:"300",ref:"imgviaje",class:"rounded-lg mt-2 w-full"},null,8,yt),wt],512),t("div",xt,[kt,m(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=a=>s.infofoto=a),class:"inp",rows:"3",placeholder:"ej. As\xED voy vestido"},null,512),[[h,s.infofoto]])],512),jt,t("button",{onClick:e[12]||(e[12]=u(a=>s.paso--,["prevent"])),class:"btn-gray"},"Volver")],32)])):_("",!0),s.paso==3?(d(),c("div",Ct,[t("form",{onSubmit:e[16]||(e[16]=u(a=>r.previsualizar(),["prevent"]))},[Ut,m(t("textarea",{"onUpdate:modelValue":e[14]||(e[14]=a=>s.infoextra=a),class:"inp",rows:"5",placeholder:"ej. Llevo un camisa blanca"},null,512),[[h,s.infoextra]]),qt,t("button",{onClick:e[15]||(e[15]=u(a=>s.paso--,["prevent"])),class:"btn-gray"},"Volver")],32)])):_("",!0),s.paso==4?(d(),c("div",Vt,[At,t("div",Ft,[t("div",null,[It,t("p",Dt,[g(p(s.destino)+" ",1),t("a",{href:s.mapa_google,target:"_blank",class:"font-semibold"},"(ver en Google Maps)",8,St)])]),s.info_destino.length>0?(d(),c("p",zt,[Nt,g(p(s.info_destino),1)])):(d(),c("p",Tt,Ht))]),t("div",Lt,[t("div",null,[Mt,t("p",Bt,p(s.hora_salida)+":"+p(s.minutos_salida),1)]),t("div",null,[Rt,t("p",Gt,p(s.hora_alerta)+":"+p(s.minutos_alerta),1)])]),t("div",Jt,[Ot,s.infofoto.length>0?(d(),c("p",Yt,[Kt,g(" "+p(s.infofoto),1)])):(d(),c("p",Pt,Wt))]),t("div",null,[s.infoextra.length>0?(d(),c("p",Xt,[Zt,g(p(s.infoextra),1)])):(d(),c("p",$t,ee))]),s.paso==4?(d(),c("button",{key:0,onClick:e[17]||(e[17]=u(a=>r.crearViaje(),["prevent"])),class:"btn-blue"}," Confirmar viaje ")):_("",!0),t("button",{onClick:e[18]||(e[18]=u(a=>s.paso--,["prevent"])),class:"btn-gray"},"Volver")])):_("",!0)],64)}var ae=S(R,[["render",se],["__scopeId","data-v-405a4170"]]);export{ae as default};
