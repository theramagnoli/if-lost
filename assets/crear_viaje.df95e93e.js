import{_ as A,a as F,I,d as D,o as S,b as z,r as N,s as T,u as E,c as d,e as c,f as t,t as p,w as h,v as m,g as u,h as _,i as g,F as H,p as L,j as M}from"./index.e333e8b3.js";const B={data(){return{destino:"",info_destino:"",hora_salida:"12",minutos_salida:"00",hora_alerta:"17",minutos_alerta:"00",infoextra:"",img:"",imgurl:"",infofoto:"",mapa:"",mapa_google:"",paso:0,srcimg:"https://firebasestorage.googleapis.com/v0/b/if-lost-159f6.appspot.com/o/assets%2Fcamera.png?alt=media"}},computed:{usuario(){return this.$store.state.usuario}},mounted(){this.obtenerUsuario(),this.mapa="https://maps.google.com/maps?q="+this.usuario.ciudad+"&t=&z=13&ie=UTF8&iwloc=&output=embed"},methods:{buscarEnMapa(){let i="https://maps.google.com/maps?q="+this.destino+", "+this.usuario.ciudad+"&t=&z=13&ie=UTF8&iwloc=&output=embed";this.mapa=i},obtenerHoraComoFecha(i,e,n){let l;if(n==!1)l=new Date().setHours(parseInt(i),parseInt(e),0);else{const s=new Date,r=new Date(s);r.setDate(r.getDate()+1),l=r.setHours(parseInt(i),parseInt(e),0)}return l},async crearViaje(){let i,n=new Date().getHours();this.hora_alerta<this.hora_salida||this.hora_alerta<n?i=!0:i=!1,await F(I(D,"viajes",this.usuario.id),{correo_contacto:this.usuario.contacto.correo,destino:this.destino,mapa:this.mapa_google,infoextra_destino:this.info_destino,hora_salida:this.hora_salida+":"+this.minutos_salida,hora_llegada:this.hora_alerta+":"+this.minutos_alerta,infoextra:this.infoextra,fecha_alerta:this.obtenerHoraComoFecha(this.hora_alerta,this.minutos_alerta,i),img:this.imgurl,infoimg:this.infofoto}),this.$router.push("/")},async previsualizar(){await this.paso++;let i=document.querySelector("#img_prev"),e=this.destino.split(" ");for(var n=0;n<e.length;n++)e[n]=e[n].charAt(0).toUpperCase()+e[n].slice(1);this.destino=e.join(" "),this.mapa_google="https://maps.google.com/maps?q="+this.destino+"&t=&z=13&ie=UTF8&iwloc=&",this.imgurl.length>1?i.src="https://firebasestorage.googleapis.com/v0/b/if-lost-159f6.appspot.com/o/viajes%2F"+this.usuario.id+"?alt=media":i.src="/images/viajedef.jpg"},obtenerUsuario(){S(z,i=>{i||this.$router.push("/login")})},async tomarFoto(){this.srcimg="https://firebasestorage.googleapis.com/v0/b/if-lost-159f6.appspot.com/o/assets%2Floading.gif?alt=media";let i=this,e=document.querySelector("#camera"),n=document.querySelector("#canvas"),l=document.querySelector("#capturar"),s=document.querySelector("#tomafoto"),r=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});this.$refs.imgviaje.setAttribute("hidden","true"),this.$refs.divfoto.removeAttribute("hidden"),n.setAttribute("hidden","true"),e.removeAttribute("hidden"),l.removeAttribute("hidden"),e.srcObject=r,l.addEventListener("click",function(){e.setAttribute("hidden","true"),n.getContext("2d").drawImage(e,0,0,n.width,n.height),this.img=n.toDataURL("image/jpeg"),i.subirImg(this.img),r.getTracks().forEach(function(a){a.stop()}),l.setAttribute("hidden","true"),s.innerHTML="\xBFNo te gust\xF3? Intenta de nuevo"})},subirImg(i){this.$refs.imgviaje.removeAttribute("hidden");let e=this;const n=document.createElement("img");n.src=i,n.onload=function(l){const s=document.createElement("canvas"),r=800,a=r/l.target.width;s.width=r,s.height=a*l.target.height;const v=s.getContext("2d");v.drawImage(l.target,0,0,s.width,s.height);const b=v.canvas.toDataURL(l.target,"image/png");function k(y,q){for(var w=y.split(","),V=w[0].match(/:(.*?);/)[1],x=atob(w[1]),f=x.length,j=new Uint8Array(f);f--;)j[f]=x.charCodeAt(f);return new File([j],q,{type:V})}var C=k(b,"perfil.png");const U=N(T,"viajes/"+e.usuario.id);E(U,C).then(y=>{e.imgurl="https://firebasestorage.googleapis.com/v0/b/if-lost-159f6.appspot.com/o/viajes%2F"+e.usuario.id+"?alt=media",e.srcimg=b})}}}},o=i=>(L("data-v-a5ba592a"),i=i(),M(),i),R=o(()=>t("h1",{class:"ttl-1"},"Crear viaje",-1)),G={class:"grid mb-8"},J={class:"justify-self-center flex text-xs"},O={class:"font-semibold text-center mt-4 bg-gray-50 text-gray-900 pt-2 pb-2 w-8 rounded-full shadow-inner"},Y=o(()=>t("h2",{class:"text-center mt-4 pt-2 pb-2 w-10"},"de",-1)),K=o(()=>t("h2",{class:"font-semibold text-center mt-4 bg-gray-50 text-gray-900 pt-2 pb-2 w-8 rounded-full shadow-inner"}," 5 ",-1)),P={key:0},Q=o(()=>t("p",{class:"lbl"},"Dinos a d\xF3nde vas",-1)),W={class:"flex"},X=o(()=>t("i",{class:"fa-solid fa-magnifying-glass"},null,-1)),Z=[X],$={class:"mapouter"},tt={class:"gmap_canvas shadow-xl"},et=["src"],st=o(()=>t("p",{class:"lbl mt-4"}," Aqu\xED puedes agregar detalles del lugar, si gustas ",-1)),ot=o(()=>t("button",{type:"submit",class:"btn-gray"},"Continuar",-1)),at={key:1},it={class:"grid"},nt=o(()=>t("p",{class:"lbl text-center"},"Dinos a qu\xE9 ahora planeas ir",-1)),rt={class:"flex place-content-center"},lt=o(()=>t("p",{class:"mx-2 place-self-center"},":",-1)),dt=o(()=>t("p",{class:"lbl text-center mt-4"},"Y la hora a la que planeas regresar",-1)),ct={class:"flex place-content-center"},ut=o(()=>t("p",{class:"mx-2 place-self-center"},":",-1)),pt=o(()=>t("button",{type:"submit",class:"btn-gray mt-12"},"Continuar",-1)),ht={key:2},mt={class:"flex mt-2"},_t=o(()=>t("p",{class:"lbl w-[88%] align-self-end flex-initial",id:"tomafoto"}," Toma una foto, si quieres ",-1)),gt=o(()=>t("i",{class:"fa-solid fa-camera"},null,-1)),ft=[gt],vt={class:"mt-2 shadow-xl",ref:"divfoto"},bt=o(()=>t("video",{width:"400",height:"300",autoplay:"",id:"camera",class:"mt-2 rounded-t-lg w-full",hidden:""},null,-1)),yt=o(()=>t("canvas",{id:"canvas",class:"mt-2 rounded-t-lg w-full",width:"400",height:"300",hidden:""},null,-1)),wt=["src"],xt=o(()=>t("button",{type:"button",id:"capturar",class:"rounded-b-lg w-full bg-sky-600 py-2 text-white hover:bg-sky-800 flex-intial",hidden:""}," Tomar foto ",-1)),jt={ref:"notafoto"},kt=o(()=>t("p",{class:"lbl mt-4"},"Agrega una nota a la foto",-1)),Ct=o(()=>t("button",{type:"submit",class:"btn-gray"},"Continuar",-1)),Ut={key:3},qt=o(()=>t("p",{class:"lbl mt-2"}," En este espacio puedes agregar una nota para tu contacto de confianza ",-1)),Vt=o(()=>t("button",{type:"submit",class:"btn-gray"},"Continuar",-1)),At={key:4},Ft=o(()=>t("div",{class:"note grid"},[t("p",{class:"font-semibold"},[g(" Aseg\xFArate que todos los detalles de tu viaje sean correctos; "),t("span",{class:"font-normal"},"en caso de no avisar antes de la hora prevista, se enviar\xE1n a tu contacto de confianza")]),t("button",{class:"btn-gray w-[60%] justify-self-end"}," Ver mi contacto de confianza ")],-1)),It={class:"mt-4 grid grid-cols-2 gap-2"},Dt=o(()=>t("p",{class:"lbl"},"Destino",-1)),St={class:"note"},zt=["href"],Nt={key:0,class:"note"},Tt=o(()=>t("span",{class:"notettl"},"Detalles",-1)),Et={key:1,class:"note"},Ht=o(()=>t("span",{class:"notettl"},"No se agregaron m\xE1s detalles",-1)),Lt=[Ht],Mt={class:"grid grid-cols-2 gap-2"},Bt=o(()=>t("p",{class:"lbl"},"Hora de salida",-1)),Rt={class:"note"},Gt=o(()=>t("p",{class:"lbl"},"Hora de regreso",-1)),Jt={class:"note"},Ot={class:"grid grid-cols-2 gap-2"},Yt=o(()=>t("img",{src:"",alt:"Imagen de viaje",id:"img_prev",class:"rounded-lg w-full mb-2 shadow-md"},null,-1)),Kt={key:0,class:"note"},Pt=o(()=>t("span",{class:"notettl"},"Nota de foto",-1)),Qt={key:1,class:"note"},Wt=o(()=>t("span",{class:"notettl"},"No se agreg\xF3 nota de foto",-1)),Xt=[Wt],Zt={key:0,class:"note"},$t=o(()=>t("span",{class:"notettl"},"Nota",-1)),te={key:1,class:"note"},ee=o(()=>t("span",{class:"notettl"},"No se agreg\xF3 una nota",-1)),se=[ee];function oe(i,e,n,l,s,r){return d(),c(H,null,[R,t("div",G,[t("div",J,[t("h2",O,p(s.paso+1),1),Y,K])]),s.paso==0?(d(),c("div",P,[t("form",{onSubmit:e[3]||(e[3]=u(a=>s.paso++,["prevent"]))},[Q,t("div",W,[h(t("input",{type:"text",id:"destino","onUpdate:modelValue":e[0]||(e[0]=a=>s.destino=a),placeholder:"Un lugar",class:"inp flex-initial w-[88%]",required:""},null,512),[[m,s.destino]]),t("button",{onClick:e[1]||(e[1]=u(a=>r.buscarEnMapa(),["prevent"])),class:"btn-blue w-[10%] ml-[2%] flex-1 mt-0"},Z)]),t("div",$,[t("div",tt,[t("iframe",{width:"100%",height:"100%",id:"gmap_canvas",src:s.mapa,frameborder:"0",scrolling:"no",marginheight:"0",marginwidth:"0"},null,8,et)])]),t("div",null,[st,h(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=a=>s.info_destino=a),placeholder:"ej. La casa de Jorge",class:"inp",rows:"3"},null,512),[[m,s.info_destino]])]),ot],32)])):_("",!0),s.paso==1?(d(),c("div",at,[t("form",{onSubmit:e[9]||(e[9]=u(a=>s.paso++,["prevent"]))},[t("div",it,[nt,t("div",rt,[h(t("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=a=>s.hora_salida=a),required:"",max:"24",class:"inp w-[30%] text-center"},null,512),[[m,s.hora_salida]]),lt,h(t("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=a=>s.minutos_salida=a),required:"",max:"60",class:"inp w-[30%] text-center"},null,512),[[m,s.minutos_salida]])]),dt,t("div",ct,[h(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=a=>s.hora_alerta=a),required:"",max:"24",class:"inp w-[30%] text-center"},null,512),[[m,s.hora_alerta]]),ut,h(t("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=a=>s.minutos_alerta=a),required:"",max:"60",class:"inp w-[30%] text-center"},null,512),[[m,s.minutos_alerta]])])]),pt,t("button",{onClick:e[8]||(e[8]=u(a=>s.paso--,["prevent"])),class:"btn-gray"},"Volver")],32)])):_("",!0),s.paso==2?(d(),c("div",ht,[t("form",{onSubmit:e[13]||(e[13]=u(a=>s.paso++,["prevent"]))},[t("div",mt,[_t,t("button",{type:"button",onClick:e[10]||(e[10]=a=>r.tomarFoto()),class:"btn-blue w-[10%] ml-[2%] mt-0 py-0"},ft)]),t("div",vt,[bt,yt,t("img",{src:s.srcimg,width:"400",height:"300",ref:"imgviaje",class:"rounded-lg mt-2 w-full"},null,8,wt),xt],512),t("div",jt,[kt,h(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=a=>s.infofoto=a),class:"inp",rows:"3",placeholder:"ej. As\xED voy vestido"},null,512),[[m,s.infofoto]])],512),Ct,t("button",{onClick:e[12]||(e[12]=u(a=>s.paso--,["prevent"])),class:"btn-gray"},"Volver")],32)])):_("",!0),s.paso==3?(d(),c("div",Ut,[t("form",{onSubmit:e[16]||(e[16]=u(a=>r.previsualizar(),["prevent"]))},[qt,h(t("textarea",{"onUpdate:modelValue":e[14]||(e[14]=a=>s.infoextra=a),class:"inp",rows:"5",placeholder:"ej. Llevo un camisa blanca"},null,512),[[m,s.infoextra]]),Vt,t("button",{onClick:e[15]||(e[15]=u(a=>s.paso--,["prevent"])),class:"btn-gray"},"Volver")],32)])):_("",!0),s.paso==4?(d(),c("div",At,[Ft,t("div",It,[t("div",null,[Dt,t("p",St,[g(p(s.destino)+" ",1),t("a",{href:s.mapa_google,target:"_blank",class:"font-semibold"},"(ver en Google Maps)",8,zt)])]),s.info_destino.length>0?(d(),c("p",Nt,[Tt,g(p(s.info_destino),1)])):(d(),c("p",Et,Lt))]),t("div",Mt,[t("div",null,[Bt,t("p",Rt,p(s.hora_salida)+":"+p(s.minutos_salida),1)]),t("div",null,[Gt,t("p",Jt,p(s.hora_alerta)+":"+p(s.minutos_alerta),1)])]),t("div",Ot,[Yt,s.infofoto.length>0?(d(),c("p",Kt,[Pt,g(" "+p(s.infofoto),1)])):(d(),c("p",Qt,Xt))]),t("div",null,[s.infoextra.length>0?(d(),c("p",Zt,[$t,g(p(s.infoextra),1)])):(d(),c("p",te,se))]),s.paso==4?(d(),c("button",{key:0,onClick:e[17]||(e[17]=u(a=>r.crearViaje(),["prevent"])),class:"btn-blue"}," Confirmar viaje ")):_("",!0),t("button",{onClick:e[18]||(e[18]=u(a=>s.paso--,["prevent"])),class:"btn-gray"},"Volver")])):_("",!0)],64)}var ie=A(B,[["render",oe],["__scopeId","data-v-a5ba592a"]]);export{ie as default};
