import{_ as D,a as F,p as S,I as k,d as C,c as z,o as T,b as E,r as H,s as N,u as L,e as d,f as c,g as t,t as p,w as h,v as m,h as u,i as _,j as v,F as M,k as B,l as R}from"./index.2b17a16c.js";const G={data(){return{destino:"",info_destino:"",hora_salida:"12",minutos_salida:"00",hora_alerta:"17",minutos_alerta:"00",nota:"",img:"",imgurl:"",infofoto:"",mapa:"",mapa_google:"",paso:0,srcimg:"https://firebasestorage.googleapis.com/v0/b/if-lost-159f6.appspot.com/o/assets%2Fcamera.png?alt=media"}},computed:{usuario(){return this.$store.getters.usuario}},mounted(){this.obtenerUsuario(),this.mapa="https://maps.google.com/maps?q="+this.usuario.ciudad+"&t=&z=13&ie=UTF8&iwloc=&output=embed"},methods:{buscarEnMapa(){let i=this.destino.split(" ");for(var e=0;e<i.length;e++)i[e]=i[e].charAt(0).toUpperCase()+i[e].slice(1);this.destino=i.join(" ");let n="https://maps.google.com/maps?q="+this.destino+", "+this.usuario.ciudad+"&t=&z=13&ie=UTF8&iwloc=&output=embed";this.mapa=n},obtenerHoraComoFecha(i,e,n){let r;if(n==!1)r=new Date().setHours(parseInt(i),parseInt(e),0);else{const s=new Date,l=new Date(s);l.setDate(l.getDate()+1),r=l.setHours(parseInt(i),parseInt(e),0)}return r},async crearViaje(){this.$refs.confirmarviaje.innerHTML="Creando viaje...";let i,n=new Date().getHours();this.hora_alerta<this.hora_salida||this.hora_alerta<n?i=!0:i=!1;let r=self.crypto.randomUUID();await F(k(C,"viajes",r),{clave:r,creador:this.usuario.id,creado:S(),contacto:{correo:this.usuario.contacto.correo,tel:this.usuario.contacto.tel},destino:this.destino,mapa:this.mapa_google,infodestino:this.info_destino,salida:this.hora_salida+":"+this.minutos_salida,llegada:this.hora_alerta+":"+this.minutos_alerta,alerta:this.obtenerHoraComoFecha(this.hora_alerta,this.minutos_alerta,i),img:this.imgurl,infoimg:this.infofoto,nota:this.nota});const s=k(C,"infoUsuarios",this.usuario.id);await z(s,{viaje:r}),this.$store.state.usuario.clave=r,this.$router.push("/")},async previsualizar(){await this.paso++;let i=document.querySelector("#img_prev"),e=this.destino.split(" ");for(var n=0;n<e.length;n++)e[n]=e[n].charAt(0).toUpperCase()+e[n].slice(1);this.destino=e.join(" "),this.mapa_google="https://maps.google.com/maps?q="+this.destino+this.usuario.ciudad+"&t=&z=13&ie=UTF8&iwloc=&",this.imgurl.length>1?i.src="https://firebasestorage.googleapis.com/v0/b/if-lost-159f6.appspot.com/o/viajes%2F"+this.usuario.id+"?alt=media":i.src="/images/viajedef.jpg"},obtenerUsuario(){T(E,i=>{i||this.$router.push("/login")})},async tomarFoto(){this.srcimg="https://firebasestorage.googleapis.com/v0/b/if-lost-159f6.appspot.com/o/assets%2Floading.gif?alt=media";let i=this,e=document.querySelector("#camera"),n=document.querySelector("#canvas"),r=document.querySelector("#capturar"),s=document.querySelector("#tomafoto"),l=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});this.$refs.imgviaje.setAttribute("hidden","true"),this.$refs.divfoto.removeAttribute("hidden"),n.setAttribute("hidden","true"),e.removeAttribute("hidden"),r.removeAttribute("hidden"),e.srcObject=l,r.addEventListener("click",function(){e.setAttribute("hidden","true"),n.getContext("2d").drawImage(e,0,0,n.width,n.height),this.img=n.toDataURL("image/jpeg"),i.subirImg(this.img),l.getTracks().forEach(function(o){o.stop()}),r.setAttribute("hidden","true"),s.innerHTML="\xBFNo te gust\xF3? Intenta de nuevo"})},subirImg(i){this.$refs.imgviaje.removeAttribute("hidden");let e=this;const n=document.createElement("img");n.src=i,n.onload=function(r){const s=document.createElement("canvas"),l=800,o=l/r.target.width;s.width=l,s.height=o*r.target.height;const f=s.getContext("2d");f.drawImage(r.target,0,0,s.width,s.height);const b=f.canvas.toDataURL(r.target,"image/png");function U(y,A){for(var w=y.split(","),I=w[0].match(/:(.*?);/)[1],x=atob(w[1]),g=x.length,j=new Uint8Array(g);g--;)j[g]=x.charCodeAt(g);return new File([j],A,{type:I})}var q=U(b,"perfil.png");const V=H(N,"viajes/"+e.usuario.id);L(V,q).then(y=>{e.imgurl="https://firebasestorage.googleapis.com/v0/b/if-lost-159f6.appspot.com/o/viajes%2F"+e.usuario.id+"?alt=media",e.srcimg=b})}}}},a=i=>(B("data-v-73865655"),i=i(),R(),i),O=a(()=>t("h1",{class:"ttl-1 mb-[5%]"},"Crear viaje",-1)),P={class:"mb-8 text-center text-gray-400"},Y={key:0},J=a(()=>t("p",{class:"lbl"},"Dinos a d\xF3nde vas",-1)),K={class:"flex"},Q=a(()=>t("span",{class:"material-symbols-rounded"}," search ",-1)),W=[Q],X={class:"mapouter"},Z={class:"gmap_canvas shadow-xl"},$=["src"],tt=a(()=>t("p",{class:"lbl mt-4"}," Aqu\xED puedes agregar detalles del lugar, si gustas ",-1)),et=a(()=>t("button",{type:"submit",class:"btn-gray"},"Continuar",-1)),st={key:1},ot={class:"grid"},at=a(()=>t("p",{class:"lbl text-center"},"Dinos a qu\xE9 ahora planeas ir",-1)),it={class:"flex place-content-center"},nt=a(()=>t("p",{class:"mx-2 place-self-center"},":",-1)),rt=a(()=>t("p",{class:"lbl text-center mt-4"},"Y a qu\xE9 hora planeas regresar",-1)),lt={class:"flex place-content-center"},dt=a(()=>t("p",{class:"mx-2 place-self-center"},":",-1)),ct=a(()=>t("button",{type:"submit",class:"btn-gray mt-12"},"Continuar",-1)),ut={key:2},pt={class:"flex mt-2"},ht=a(()=>t("p",{class:"lbl w-[88%] align-self-end flex-initial",id:"tomafoto"}," Toma una foto, si quieres ",-1)),mt=a(()=>t("span",{class:"material-symbols-rounded"}," android_camera ",-1)),_t=[mt],gt={class:"mt-2 shadow-xl",ref:"divfoto"},vt=a(()=>t("video",{width:"400",height:"300",autoplay:"",id:"camera",class:"mt-2 rounded-t-lg w-full",hidden:""},null,-1)),ft=a(()=>t("canvas",{id:"canvas",class:"mt-2 rounded-t-lg w-full",width:"400",height:"300",hidden:""},null,-1)),bt=["src"],yt=a(()=>t("button",{type:"button",id:"capturar",class:"rounded-b-lg w-full bg-sky-600 py-2 text-white hover:bg-sky-800 flex-intial",hidden:""}," Tomar foto ",-1)),wt={ref:"notafoto"},xt=a(()=>t("p",{class:"lbl mt-4"},"Agrega una nota a la foto",-1)),jt=a(()=>t("button",{type:"submit",class:"btn-gray"},"Continuar",-1)),kt={key:3},Ct=a(()=>t("p",{class:"lbl mt-2"},"En este espacio puedes agregar una nota",-1)),Ut=a(()=>t("button",{type:"submit",class:"btn-gray"},"Continuar",-1)),qt={key:4},Vt=a(()=>t("div",{class:"note grid"},[t("p",null," Aseg\xFArate que todos los detalles de tu viaje sean correctos. En caso de no avisar antes de la hora prevista, se enviar\xE1n a tu contacto de confianza "),t("button",{class:"btn-gray w-[60%] justify-self-end"}," Ver mi contacto de confianza ")],-1)),At={class:"mt-4 grid grid-cols-2 gap-2"},It=a(()=>t("p",{class:"lbl"},"Destino",-1)),Dt={class:"note"},Ft=["href"],St={key:0,class:"note"},zt=a(()=>t("span",{class:"notettl"},"Detalles",-1)),Tt={key:1,class:"note"},Et=a(()=>t("span",{class:"notettl"},"No se agregaron m\xE1s detalles",-1)),Ht=[Et],Nt={class:"grid grid-cols-2 gap-2"},Lt=a(()=>t("p",{class:"lbl"},"Hora de salida",-1)),Mt={class:"note"},Bt=a(()=>t("p",{class:"lbl"},"Hora de regreso",-1)),Rt={class:"note"},Gt={class:"grid grid-cols-2 gap-2"},Ot=a(()=>t("img",{src:"",alt:"Imagen de viaje",id:"img_prev",class:"rounded-lg w-full mb-2 shadow-md"},null,-1)),Pt={key:0,class:"note"},Yt=a(()=>t("span",{class:"notettl"},"Nota de foto",-1)),Jt={key:1,class:"note"},Kt=a(()=>t("span",{class:"notettl"},"No se agreg\xF3 nota de foto",-1)),Qt=[Kt],Wt={key:0,class:"note"},Xt=a(()=>t("span",{class:"notettl"},"Nota",-1)),Zt={key:1,class:"note"},$t=a(()=>t("span",{class:"notettl"},"No se agreg\xF3 una nota",-1)),te=[$t];function ee(i,e,n,r,s,l){return d(),c(M,null,[O,t("div",P,[t("p",null,"Paso "+p(s.paso+1)+" de 5",1)]),s.paso==0?(d(),c("div",Y,[t("form",{onSubmit:e[3]||(e[3]=u(o=>s.paso++,["prevent"]))},[J,t("div",K,[h(t("input",{type:"text",id:"destino","onUpdate:modelValue":e[0]||(e[0]=o=>s.destino=o),placeholder:"Un lugar",class:"inp flex-initial w-[88%]",required:""},null,512),[[m,s.destino]]),t("button",{onClick:e[1]||(e[1]=u(o=>l.buscarEnMapa(),["prevent"])),class:"btn-blue w-[10%] ml-[2%] flex-1 mt-0 pb-0"},W)]),t("div",X,[t("div",Z,[t("iframe",{width:"100%",height:"100%",id:"gmap_canvas",src:s.mapa,frameborder:"0",scrolling:"no",marginheight:"0",marginwidth:"0"},null,8,$)])]),t("div",null,[tt,h(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>s.info_destino=o),placeholder:"ej. La casa de un amigo o amiga",class:"inp",rows:"3"},null,512),[[m,s.info_destino]])]),et],32)])):_("",!0),s.paso==1?(d(),c("div",st,[t("form",{onSubmit:e[9]||(e[9]=u(o=>s.paso++,["prevent"]))},[t("div",ot,[at,t("div",it,[h(t("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=o=>s.hora_salida=o),required:"",max:"24",class:"inp w-[30%] text-center"},null,512),[[m,s.hora_salida]]),nt,h(t("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=o=>s.minutos_salida=o),required:"",max:"60",class:"inp w-[30%] text-center"},null,512),[[m,s.minutos_salida]])]),rt,t("div",lt,[h(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=o=>s.hora_alerta=o),required:"",max:"24",class:"inp w-[30%] text-center"},null,512),[[m,s.hora_alerta]]),dt,h(t("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=o=>s.minutos_alerta=o),required:"",max:"60",class:"inp w-[30%] text-center"},null,512),[[m,s.minutos_alerta]])])]),ct,t("button",{onClick:e[8]||(e[8]=u(o=>s.paso--,["prevent"])),class:"btn-gray"},"Volver")],32)])):_("",!0),s.paso==2?(d(),c("div",ut,[t("form",{onSubmit:e[13]||(e[13]=u(o=>s.paso++,["prevent"]))},[t("div",pt,[ht,t("button",{type:"button",onClick:e[10]||(e[10]=o=>l.tomarFoto()),class:"btn-blue w-[10%] ml-[2%] mt-0 pb-0"},_t)]),t("div",gt,[vt,ft,t("img",{src:s.srcimg,width:"400",height:"300",ref:"imgviaje",class:"rounded-lg mt-2 w-full"},null,8,bt),yt],512),t("div",wt,[xt,h(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=o=>s.infofoto=o),class:"inp",rows:"3",placeholder:"ej. As\xED voy vestido"},null,512),[[m,s.infofoto]])],512),jt,t("button",{onClick:e[12]||(e[12]=u(o=>s.paso--,["prevent"])),class:"btn-gray"},"Volver")],32)])):_("",!0),s.paso==3?(d(),c("div",kt,[t("form",{onSubmit:e[16]||(e[16]=u(o=>l.previsualizar(),["prevent"]))},[Ct,h(t("textarea",{"onUpdate:modelValue":e[14]||(e[14]=o=>s.nota=o),class:"inp",rows:"5",placeholder:"Lo que sea, esta nota solo la ver\xE1 tu contacto de confianza"},null,512),[[m,s.nota]]),Ut,t("button",{onClick:e[15]||(e[15]=u(o=>s.paso--,["prevent"])),class:"btn-gray"},"Volver")],32)])):_("",!0),s.paso==4?(d(),c("div",qt,[Vt,t("div",At,[t("div",null,[It,t("p",Dt,[v(p(s.destino)+" ",1),t("a",{href:s.mapa_google,target:"_blank",class:"font-semibold"},"(ver en Google Maps)",8,Ft)])]),s.info_destino.length>0?(d(),c("p",St,[zt,v(p(s.info_destino),1)])):(d(),c("p",Tt,Ht))]),t("div",Nt,[t("div",null,[Lt,t("p",Mt,p(s.hora_salida)+":"+p(s.minutos_salida),1)]),t("div",null,[Bt,t("p",Rt,p(s.hora_alerta)+":"+p(s.minutos_alerta),1)])]),t("div",Gt,[Ot,s.infofoto.length>0?(d(),c("p",Pt,[Yt,v(" "+p(s.infofoto),1)])):(d(),c("p",Jt,Qt))]),t("div",null,[s.nota.length>0?(d(),c("p",Wt,[Xt,v(p(s.nota),1)])):(d(),c("p",Zt,te))]),s.paso==4?(d(),c("button",{key:0,onClick:e[17]||(e[17]=u(o=>l.crearViaje(),["prevent"])),class:"btn-blue",ref:"confirmarviaje"}," Confirmar viaje ",512)):_("",!0),t("button",{onClick:e[18]||(e[18]=u(o=>s.paso--,["prevent"])),class:"btn-gray"},"Volver")])):_("",!0)],64)}var oe=D(G,[["render",ee],["__scopeId","data-v-73865655"]]);export{oe as default};
